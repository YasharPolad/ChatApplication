<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slacker</title>
    <script src="signalr/signalr.min.js"></script>     
</head>
<body>

    Connection Id
    <input type="number" id="connectionId">
    Message
    <input type="text" id="inputMessage">
    <button type="submit" id="sendButton">Send</button>

    <div id = "messages"></div>

 



    <script>
        const inputBox = document.getElementById("inputMessage");
        const messageBox = document.getElementById("messages");
        const channel = document.getElementById("connectionId");
        const sendButton = document.getElementById("sendButton");
        var loginToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJ5YXNoYXJmYWNlQGdtYWlsLmNvbSIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWVpZGVudGlmaWVyIjoiMmMyYmNlNjctOGJhMS00NGUyLTlhZjctNGZmZjY1YmFiNGI3IiwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvbmFtZSI6Inlhc2hhcmZhY2UiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJEZWZhdWx0IiwiZXhwIjoxNjY5NDQ5NjAwLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjUyODEiLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjUyODEifQ.WSnFHcWFbn4K4lyT6S2RfLbykIIo-ANCifu8Y0MUrSY"
        
        
        const connection = new signalR.HubConnectionBuilder()
                            .withUrl("http://localhost:5281/chat", { accessTokenFactory: () => this.loginToken })
                            .build();
        document.getElementById("sendButton").disabled = true;
           

        
    
        connection.start().then(function () {
        document.getElementById("sendButton").disabled = false;
        }).catch(function (err) {
            return console.error(err.toString());
        });


        //Triggers

        connection.on("messageReceiver", (message, user) => {
            messageBox.append(user + says + message + "<br>");
        })


        // Methods

        sendButton.addEventListener("click", () => {
            var message = inputBox.value;
            var channelId = channel.value;
            connection.invoke("SendMessageAsync", message, channelId)
                      .catch(error => console.log(`An error was encountered ${error}`));
        })


    </script> 
</body>
</html>